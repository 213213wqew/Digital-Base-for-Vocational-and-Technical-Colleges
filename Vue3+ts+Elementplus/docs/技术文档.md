# Vue3+TS+Element Plus 前端技术文档

## 一、技术栈概述

### 1.1 核心技术

| 技术 | 版本 | 说明 |
|------|-----|------|
| Vue | 3.4.0 | 前端框架 |
| TypeScript | 5.3.0 | 类型系统 |
| Element Plus | 2.5.0 | UI组件库 |
| Vite | 5.0.8 | 构建工具 |
| Vue Router | 4.2.5 | 路由管理 |
| Pinia | 2.1.7 | 状态管理 |
| Axios | 1.6.0 | HTTP请求库 |
| SCSS | 1.89.0 | CSS预处理器 |
| ECharts | 5.4.3 | 图表库 |
| VueUse | 10.7.0 | 组合式API工具集 |

### 1.2 项目结构

```
Vue3+ts+Elementplus/
├── public/                 # 静态资源
├── src/                    # 源代码
│   ├── api/                # API接口
│   ├── assets/             # 项目资源
│   ├── components/         # 通用组件
│   ├── data/               # 模拟数据
│   ├── directives/         # 自定义指令
│   ├── hooks/              # 自定义钩子函数
│   ├── layout/             # 布局组件
│   ├── router/             # 路由配置
│   ├── store/              # 状态管理
│   ├── styles/             # 全局样式
│   ├── types/              # 类型定义
│   ├── utils/              # 工具函数
│   ├── views/              # 页面组件
│   ├── App.vue             # 根组件
│   └── main.ts             # 入口文件
├── docs/                   # 文档目录
├── index.html              # HTML模板
├── tsconfig.json           # TypeScript配置
├── vite.config.ts          # Vite配置
└── package.json            # 项目依赖
```

## 二、设计规范

### 2.1 设计系统

项目采用了完整的设计规范系统，定义在 `/docs/DESIGN_SPECIFICATION.md` 文件中，主要包括：

#### 2.1.1 颜色系统

```scss
// 主色调
$primary-gradient: linear-gradient(125deg, #5E77FB 0%, #6D74F2 45%, #9088F3 75%, #A86FEC 100%);
$primary-color: #5E77FB;
$primary-color-light: #6D74F2;
$primary-color-lighter: #9088F3;
$primary-color-dark: #4169E1;

// 辅助色
$success-color: #67C23A;
$warning-color: #E6A23C;
$danger-color: #F56C6C;
$info-color: #909399;
```

#### 2.1.2 布局规范

系统采用 24 列栅格系统，支持以下几种布局方式：
- 左侧菜单 + 顶部导航 + 主内容区
- 顶部导航 + 主内容区
- 左侧菜单 + 主内容区

#### 2.1.3 组件样式规范

项目对 Element Plus 组件进行了统一样式覆盖，保持视觉一致性。样式覆盖文件位于：`/src/styles/element-overrides.scss`。

### 2.2 样式变量系统

样式变量定义在 `/src/styles/variables.scss` 文件中，并通过 CSS 变量导出供全局使用：

```scss
:root {
  --primary-color: #{$primary-color};
  --success-color: #{$success-color};
  --warning-color: #{$warning-color};
  --danger-color: #{$danger-color};
  --info-color: #{$info-color};
  // ...更多变量
}
```

## 三、权限系统

### 3.1 权限控制机制

项目采用基于 RBAC 的权限控制系统，通过以下几种方式实现权限控制：

#### 3.1.1 路由权限控制

```typescript
// 路由元信息定义
interface RouteMeta {
  title?: string;           // 页面标题
  icon?: string;            // 菜单图标
  hidden?: boolean;         // 是否在菜单中隐藏
  alwaysShow?: boolean;     // 是否总是显示
  roles?: string[];         // 可访问角色
  permissions?: string[];   // 所需权限
  keepAlive?: boolean;      // 是否缓存组件
  breadcrumb?: boolean;     // 是否显示在面包屑
  activeMenu?: string;      // 激活的菜单
}

// 路由权限过滤示例
const filterAsyncRoutes = (routes: RouteRecordRaw[], permissions: string[]) => {
  return routes.filter(route => {
    // 检查权限
    if (route.meta?.permissions) {
      return hasPermission(permissions, route.meta.permissions);
    }
    return true;
  });
};
```

#### 3.1.2 组件权限控制

使用自定义指令控制元素的显示/隐藏：

```typescript
// 权限指令
const permission: Directive = {
  mounted(el: HTMLElement, binding: DirectiveBinding) {
    const userStore = useUserStore();
    const { value, arg } = binding;
    
    let hasPermission = false;
    
    if (arg === 'role') {
      // 角色权限检查
      hasPermission = userStore.hasRole(value);
    } else {
      // 普通权限检查
      hasPermission = userStore.hasPermission(value);
    }
    
    if (!hasPermission) {
      // 移除元素
      el.parentNode?.removeChild(el);
    }
  }
};

// 使用方式
// v-permission="'system:user:create'"
// v-permission:role="'admin'"
```

### 3.2 状态管理

项目使用 Pinia 进行状态管理，主要包含以下几个 Store：

#### 3.2.1 用户状态

```typescript
// src/store/modules/user.ts
export const useUserStore = defineStore('user', {
  state: (): UserState => ({
    token: getToken() || '',
    userInfo: {/* 用户信息结构 */}
  }),
  
  getters: {
    isLoggedIn: (state) => !!state.token,
    roleCodes: (state) => state.userInfo.roles.map(role => role.code),
    permissionCodes: (state) => state.userInfo.permissions,
    isAdmin: (state) => state.userInfo.roles.some(role => role.code === 'admin')
  },
  
  actions: {
    async login(loginParams) {/* 登录逻辑 */},
    logout() {/* 登出逻辑 */},
    hasPermission(permission) {/* 权限检查逻辑 */},
    hasRole(role) {/* 角色检查逻辑 */}
  }
});
```

#### 3.2.2 菜单状态

```typescript
// src/store/modules/menu.ts
export const useMenuStore = defineStore('menu', () => {
  // 状态
  const menuList = ref<MenuItem[]>([]);
  const userPermissions = ref<string[]>([]);
  
  // 计算属性
  const filteredMenuList = computed(() => {
    // 根据权限过滤菜单
  });
  
  // 方法
  const initMenuData = async () => {/* 初始化菜单数据 */};
  const setUserPermissions = (permissions: string[]) => {/* 设置用户权限 */};
  const hasPermission = (permission: string) => {/* 检查权限 */};
  
  return {
    menuList,
    userPermissions,
    filteredMenuList,
    initMenuData,
    setUserPermissions,
    hasPermission
  };
});
```

## 四、API 请求封装

### 4.1 请求工具

项目使用封装的 Axios 进行 API 请求，主要封装逻辑如下：

```typescript
// src/utils/request.ts
import axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';

// 创建axios实例
const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL as string,
  timeout: 15000
});

// 请求拦截器
service.interceptors.request.use(
  (config) => {
    // 添加token到请求头
    const token = getToken();
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
service.interceptors.response.use(
  (response: AxiosResponse<ApiResponse<any>>) => {
    const res = response.data;
    
    // 如果状态码不是200，认为请求错误
    if (res.code !== 200) {
      // 处理错误
      // ...
      return Promise.reject(new Error(res.message || '系统错误'));
    } else {
      // 请求成功，返回数据
      return res.data;
    }
  },
  (error) => {
    // 处理网络错误
    // ...
    return Promise.reject(error);
  }
);

// 封装请求方法
export const request = {
  get<T = any>(url: string, params?: any, config?: AxiosRequestConfig): Promise<T> {
    return service.get(url, { params, ...config });
  },
  
  post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return service.post(url, data, config);
  },
  
  // ...其他请求方法
  
  // 权限验证请求方法
  withPermission<T = any>(
    permission: string | string[],
    requestFn: () => Promise<T>
  ): Promise<T> {
    if (!checkPermission(permission)) {
      ElMessage.error('您没有执行此操作的权限');
      return Promise.reject(new Error('没有权限'));
    }
    return requestFn();
  }
};

export default request;
```

### 4.2 API 模块化

API 请求按功能模块拆分，放置在 `/src/api/` 目录下：

```typescript
// src/api/user.ts
import request from '@/utils/request';
import type { UserInfo, PageParams, PageResult } from '@/types';

export const userApi = {
  getUserList(params: PageParams) {
    return request.get<PageResult<UserInfo>>('/system/user/list', params);
  },
  
  getUserDetail(id: string) {
    return request.get<UserInfo>(`/system/user/${id}`);
  },
  
  // ...其他用户相关API
  
  // 使用权限验证的API
  deleteUserWithPermission(id: string) {
    return request.withPermission('system:user:delete', () => {
      return userApi.deleteUser(id);
    });
  }
};
```

## 五、接口规范

### 5.1 数据传输对象

#### 5.1.1 通用响应格式

```typescript
export interface ApiResponse<T = any> {
  code: number;
  message: string;
  data: T;
  success: boolean;
}
```

#### 5.1.2 分页请求参数

```typescript
export interface PageParams {
  current: number;
  size: number;
  [key: string]: any;
}
```

#### 5.1.3 分页响应格式

```typescript
export interface PageResult<T = any> {
  records: T[];
  total: number;
  current: number;
  size: number;
  pages: number;
}
```

### 5.2 用户认证接口

#### 5.2.1 登录接口

- **请求方法**：`POST`
- **URL**：`/api/auth/login`
- **请求参数**：

```typescript
export interface LoginParams {
  username: string;
  password: string;
  captcha?: string;
  rememberMe?: boolean;
}
```

- **响应数据**：

```typescript
export interface LoginResult {
  token: string;
  refreshToken: string;
  userInfo: UserInfo;
}
```

#### 5.2.2 获取用户信息

- **请求方法**：`GET`
- **URL**：`/api/auth/info`
- **响应数据**：

```typescript
export interface UserInfo {
  id: string;
  username: string;
  nickname: string;
  avatar?: string;
  email?: string;
  phone?: string;
  status: number;
  roles: Role[];
  permissions: string[];
  lastLoginTime?: string;
  createTime: string;
}
```

### 5.3 菜单相关接口

#### 5.3.1 获取菜单列表

- **请求方法**：`GET`
- **URL**：`/api/system/menus`
- **响应数据**：

```typescript
export interface MenuItem {
  id: number;
  name: string;
  path: string;
  icon: string;
  component?: string;
  type: 'menu' | 'catalog' | 'button';
  sort: number;
  visible: boolean;
  status: number;
  permissions: string[];
  parentId?: number;
  children?: MenuItem[];
  meta?: {
    title: string;
    requireAuth: boolean;
    cache?: boolean;
    hidden?: boolean;
    link?: string;
  };
}
```

#### 5.3.2 获取用户菜单权限

- **请求方法**：`GET`
- **URL**：`/api/system/menus/user-permissions/{userId}`
- **响应数据**：

```typescript
export interface UserMenuPermissions {
  userId: number;
  permissions: string[];
  menuList: MenuItem[];
}
```

### 5.4 用户管理接口

#### 5.4.1 获取用户列表

- **请求方法**：`GET`
- **URL**：`/api/system/user/list`
- **请求参数**：`PageParams & { username?: string, status?: number, ... }`
- **响应数据**：`PageResult<UserInfo>`

#### 5.4.2 获取用户详情

- **请求方法**：`GET`
- **URL**：`/api/system/user/{id}`
- **响应数据**：`UserInfo`

#### 5.4.3 添加用户

- **请求方法**：`POST`
- **URL**：`/api/system/user`
- **请求参数**：`Partial<UserInfo>`
- **响应数据**：`UserInfo`

#### 5.4.4 更新用户

- **请求方法**：`PUT`
- **URL**：`/api/system/user/{id}`
- **请求参数**：`Partial<UserInfo>`
- **响应数据**：`boolean`

#### 5.4.5 删除用户

- **请求方法**：`DELETE`
- **URL**：`/api/system/user/{id}`
- **响应数据**：`boolean`

## 六、组件开发规范

### 6.1 组件目录结构

```
components/
├── common/               # 通用组件
│   ├── AppHeader.vue     # 应用头部
│   ├── AppFooter.vue     # 应用底部
│   ├── AppSidebar.vue    # 侧边栏
│   └── ...
├── form/                 # 表单相关组件
│   ├── SearchForm.vue    # 搜索表单
│   ├── DetailForm.vue    # 详情表单
│   └── ...
├── table/                # 表格相关组件
│   ├── StandardTable.vue # 标准表格
│   ├── ActionBar.vue     # 操作栏
│   └── ...
└── ...
```

### 6.2 组件编写规范

#### 6.2.1 组件命名

- 使用 PascalCase 命名自定义组件
- 使用 kebab-case 命名组件文件
- 基础组件使用 Base 前缀

#### 6.2.2 组件结构

```vue
<template>
  <!-- 组件模板，保持结构清晰 -->
</template>

<script setup lang="ts">
// 1. 引入依赖
import { ref, reactive, computed, onMounted } from 'vue';
import type { PropType } from 'vue';

// 2. 定义Props
const props = defineProps({
  title: {
    type: String,
    required: true
  },
  data: {
    type: Array as PropType<any[]>,
    default: () => []
  }
});

// 3. 定义Emits
const emit = defineEmits(['change', 'update']);

// 4. 响应式数据
const loading = ref(false);
const formData = reactive({
  // 表单数据
});

// 5. 计算属性
const computedValue = computed(() => {
  // 计算逻辑
  return result;
});

// 6. 方法定义
const handleSubmit = () => {
  // 处理逻辑
  emit('update', formData);
};

// 7. 生命周期钩子
onMounted(() => {
  // 初始化逻辑
});
</script>

<style lang="scss" scoped>
/* 组件样式，使用scoped避免样式污染 */
</style>
```

### 6.3 表单验证规范

使用 Element Plus 的表单验证：

```typescript
// 表单验证规则示例
const rules = {
  username: [
    { required: true, message: '请输入用户名', trigger: 'blur' },
    { min: 3, max: 20, message: '用户名长度在 3 到 20 个字符', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' },
    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
  ],
  email: [
    { required: true, message: '请输入邮箱', trigger: 'blur' },
    { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' }
  ],
  phone: [
    { required: true, message: '请输入手机号', trigger: 'blur' },
    { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号格式', trigger: 'blur' }
  ]
};
```

## 七、路由规范

### 7.1 路由配置

```typescript
// src/router/index.ts
import { createRouter, createWebHistory, RouteRecordRaw } from 'vue-router';

// 路由元信息定义
interface RouteMeta {
  title?: string;           // 页面标题
  icon?: string;            // 菜单图标
  hidden?: boolean;         // 是否在菜单中隐藏
  alwaysShow?: boolean;     // 是否总是显示
  roles?: string[];         // 可访问角色
  keepAlive?: boolean;      // 是否缓存组件
  breadcrumb?: boolean;     // 是否显示在面包屑
  activeMenu?: string;      // 激活的菜单
}

// 路由配置示例
const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/system/auth/Login.vue'),
    meta: { 
      hidden: true,
      title: '登录' 
    }
  },
  {
    path: '/',
    component: Layout,
    redirect: '/dashboard',
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/index.vue'),
        meta: { 
          title: '首页', 
          icon: 'Dashboard',
          keepAlive: true
        }
      }
    ]
  },
  {
    path: '/system',
    component: Layout,
    redirect: '/system/user',
    meta: { 
      title: '系统管理', 
      icon: 'Setting',
      roles: ['admin'] 
    },
    children: [
      {
        path: 'user',
        name: 'User',
        component: () => import('@/views/system/user/index.vue'),
        meta: { 
          title: '用户管理', 
          icon: 'User',
          keepAlive: true
        }
      }
    ]
  }
];
```

### 7.2 路由守卫

```typescript
// src/router/permission.ts
import router from './index';
import { useUserStore } from '@/store/modules/user';
import { usePermissionStore } from '@/store/modules/permission';
import NProgress from 'nprogress';

// 白名单路径
const whiteList = ['/login', '/auth-redirect', '/404', '/403'];

router.beforeEach(async (to, from, next) => {
  NProgress.start();
  
  const userStore = useUserStore();
  const permissionStore = usePermissionStore();
  
  // 判断是否有token
  if (userStore.isLoggedIn) {
    if (to.path === '/login') {
      // 已登录状态访问登录页，重定向到首页
      next({ path: '/' });
      NProgress.done();
    } else {
      // 检查用户信息是否存在
      if (userStore.userInfo?.id) {
        next();
      } else {
        try {
          // 获取用户信息
          await userStore.getUserInfo();
          
          // 生成路由
          const routes = await permissionStore.generateRoutes(userStore.permissionCodes);
          
          // 动态添加路由
          routes.forEach(route => {
            router.addRoute(route);
          });
          
          // 重新导航到目标页面
          next({ ...to, replace: true });
        } catch (error) {
          // 获取信息失败，跳转到登录页
          userStore.logout();
          next(`/login?redirect=${to.path}`);
          NProgress.done();
        }
      }
    }
  } else {
    // 没有token
    if (whiteList.includes(to.path)) {
      // 白名单中的页面可以直接访问
      next();
    } else {
      // 其他页面重定向到登录页
      next(`/login?redirect=${to.path}`);
      NProgress.done();
    }
  }
});

router.afterEach(() => {
  NProgress.done();
});
```

## 八、最佳实践

### 8.1 样式编写规范

1. **使用预处理器**：
   - 使用 SCSS 作为样式预处理器
   - 使用嵌套语法组织样式结构
   - 避免过深的嵌套（不超过4层）

2. **CSS 变量使用**：
   ```scss
   // 在组件中使用
   .my-component {
     color: var(--primary-color);
     border-radius: var(--border-radius);
   }
   ```

3. **响应式设计**：
   - 优先使用 flex 或 grid 布局
   - 使用媒体查询适配不同屏幕尺寸
   - 关键尺寸使用相对单位 (rem, %, vh/vw)

### 8.2 TypeScript 使用规范

1. **接口和类型**：
   - 使用 `interface` 定义对象结构
   - 使用 `type` 定义联合类型、交叉类型等
   - 为所有重要的数据结构定义类型

2. **泛型**：
   - 适当使用泛型提高代码复用性和类型安全性

3. **类型断言**：
   - 尽量避免使用 `as any`
   - 优先使用 `as` 语法而非 `<>` 语法

4. **可选属性和空值处理**：
   - 使用 `?` 标记可选属性
   - 使用 `??` 和 `?.` 运算符处理空值

### 8.3 打包优化策略

1. **代码分割**：
   - 路由懒加载
   - 组件动态导入
   - 第三方库分离

2. **缓存利用**：
   - 开启持久化缓存
   - 配置合理的缓存策略

3. **资源优化**：
   - 图片压缩和适当使用 WebP 格式
   - 小图标使用 SVG 或字体图标
   - 使用 gzip/brotli 压缩 